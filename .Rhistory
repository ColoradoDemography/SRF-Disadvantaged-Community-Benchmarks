group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
names(s4debt)
View(select(s4debt, LG_ID, NAME, debt))
View(select(s4debt, LG_ID, NAME, debt, AUDIT_YEAR))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3),LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
View(s4debt)
View(select(s4debt, LG_ID, NAME, debt, AUDIT_YEAR))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
names(s4debt)
View(s4debt)
View(select(LG_ID, NAME, AUDIT_YEAR, CM_FUND_TYPE_ID, GO_DEBT,REVENUE_DEBT, OTHER_DEBT, debt))
View(select(s4debt,LG_ID, NAME, AUDIT_YEAR, CM_FUND_TYPE_ID, GO_DEBT,REVENUE_DEBT, OTHER_DEBT, debt))
x=select(s4debt,LG_ID, NAME, AUDIT_YEAR, CM_FUND_TYPE_ID, GO_DEBT,REVENUE_DEBT, OTHER_DEBT, debt))
x=select(s4debt,LG_ID, NAME, AUDIT_YEAR, CM_FUND_TYPE_ID, GO_DEBT,REVENUE_DEBT, OTHER_DEBT, debt)
View(x)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))
y=anti_join(s3_data, s4debt. by="LG_ID")
y=anti_join(s3_data, s4debt, by="LG_ID")
y
z=unique(x$LG_ID)
z
hu4=housingunits%>%
filter(year>=2010, year<=2014)%>%
select(LG_ID, year, totalhousingunits)%>%
group_by(LG_ID)%>%
summarize(housingunits=mean(as.numeric(totalhousingunits)))
library(codemog)
devtools::install_github("robkemp/codemog")
library(codemog)
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "150", geography = "sumlev")
View(mhv4)
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "160", geography = "sumlev")
View(mhv4)
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "150", geography = "sumlev")%>%
inner_join(oisplace, c("place"= "PLACE"))
str(mhv4)
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "150", geography = "sumlev")%>%
mutate(place=as.numeric(place))%>%
inner_join(oisplace, c("place"= "PLACE"))
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "150", geography = "sumlev")%>%
mutate(place=as.numeric(place))%>%
left_join(oisplace, c("place"= "PLACE"))
View(mhv4)
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")
s4_data=hu4%>%
left_join(mhv4, by="LG_ID")
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")
View(s4_data)
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "160", geography = "sumlev")%>%
mutate(place=as.numeric(place))%>%
left_join(oisplace, c("place"= "PLACE"))
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))
View(s4_data)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))%>%
select(LG_ID, NAME, debt)
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s4debt, by="LG_ID")
View(mhv4)
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "160", geography = "sumlev")%>%
mutate(place=as.numeric(place),
mhv=as.numeric(b25077001))%>%
left_join(oisplace, c("place"= "PLACE"))
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
mutate(s4metric=debt/housingunits/mhv)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))%>%
select(LG_ID, NAME, debt)
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s4debt, by="LG_ID")%>%
mutate(s4metric=debt/housingunits/mhv)
s4_benchmark=median(s4_data$s4metric)
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s4debt, by="LG_ID")
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "160", geography = "sumlev")%>%
mutate(place=as.numeric(place),
mhv=as.numeric(b25077001))%>%
left_join(oisplace, c("place"= "PLACE"))
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s4debt, by="LG_ID")%>%
mutate(s4metric=debt/housingunits/mhv)
s4_benchmark=median(s4_data$s4metric)
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s4debt, by="LG_ID")%>%
mutate(s4metric=debt/housingunits/mhv,
s4metric=ifelse(is.na(s4metric), 0,s4metric))
s4_benchmark=median(s4_data$s4metric)
s5debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(cost=EXP_OPERATING+EXP_TRANSFER+DEPRECIATION)%>%
group_by(LG_ID, NAME)%>%
summarize(cost=mean(cost))%>%
select(LG_ID, NAME, cost)
## WHY AM I GETTING ONLY 235
##LIST OF PLACE NOT IN THERE
y5=anti_join(s3_data, s5debt, by="LG_ID")
s5debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(cost=EXP_OPERATING+EXP_TRANSFER_OUT+DEPRECIATION)%>%
group_by(LG_ID, NAME)%>%
summarize(cost=mean(cost))%>%
select(LG_ID, NAME, cost)
## WHY AM I GETTING ONLY 235
##LIST OF PLACE NOT IN THERE
y5=anti_join(s3_data, s5debt, by="LG_ID")
s5debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)
names(s5debt)
names(cm_audit)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)
View(s4debt)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)
View(s4debt)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME< AUDIT_YEAR)%>%
summarize(debt=mean(debt))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, AUDIT_YEAR)%>%
summarize(debt=mean(debt))
View(s4debt)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
View(arrange(s4debt, LG_ID, AUDIT_YEAR))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, AUDIT_YEAR)%>%
summarize(debt=mean(debt))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, AUDIT_YEAR)%>%
summarize(debt=sum(debt))
s4debt_2and3=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, AUDIT_YEAR)%>%
summarize(debt=sum(debt))%>%
ungroup()%>%
group_by(LG_ID, NAME)%>%
ummarize(debt=mean(debt))
s4debt_2and3=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, AUDIT_YEAR)%>%
summarize(debt=sum(debt))%>%
ungroup()%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))
s4debt_1=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, AUDIT_YEAR)%>%
summarize(debt=sum(debt))%>%
ungroup()%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))
s4debt_2and3=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, CM_FUND_TYPE_ID)%>%
summarize(debt=sum(debt))
View(s4debt_2and3)
rm(s4debt_1)
rm(s4debt_2and3)
s4debt_sep=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, CM_FUND_TYPE_ID)%>%
summarize(debt=sum(debt))
library(RODBC)
library(tidyverse)
library(codemogAPI)
library(codemog)
s4debt_ws=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, AUDIT_YEAR)%>%
summarize(debt=sum(debt))%>%
ungroup()%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))
s4_data_ws=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s4debt_ws, by="LG_ID")%>%
mutate(s4metric=debt/housingunits/mhv,
s4metric=ifelse(is.na(s4metric), 0,s4metric))
rm(s4_data)
s4_data_sep=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s4debt_sep, by="LG_ID")%>%
mutate(s4metric=debt/housingunits/mhv,
s4metric=ifelse(is.na(s4metric), 0,s4metric))
s4debt_sep=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, CM_FUND_TYPE_ID)%>%
summarize(debt=sum(debt))%>%
select(LG_ID, NAME, debt)
s4_data_sep=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s4debt_sep, by="LG_ID")%>%
mutate(s4metric=debt/housingunits/mhv,
s4metric=ifelse(is.na(s4metric), 0,s4metric))
s4_benchmark_ws=median(s4_data_ws$s4metric)
s4_benchmark_sep=s4_data_sep%>%
group_by(CM_FUND_TYPE_ID)%>%
summarize(s4_benchmark_sep=median(s4metric))
s4debt_sep=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, CM_FUND_TYPE_ID)%>%
summarize(debt=sum(debt))%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, debt)
s4_benchmark_ws=median(s4_data_ws$s4metric)
s4_benchmark_sep=s4_data_sep%>%
group_by(CM_FUND_TYPE_ID)%>%
summarize(s4_benchmark_sep=median(s4metric))
s4_data_sep=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s4debt_sep, by="LG_ID")%>%
mutate(s4metric=debt/housingunits/mhv,
s4metric=ifelse(is.na(s4metric), 0,s4metric))
s4_benchmark_sep=s4_data_sep%>%
group_by(CM_FUND_TYPE_ID)%>%
summarize(s4_benchmark_sep=median(s4metric))
View(s4_benchmark_sep)
rm(s5debt)
cm_audit=cm_audit%>%
select(LG_ID, CM_AUDIT_ID, AUDIT_YEAR)
s5acost_ws=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(cost=EXP_OPERATING+EXP_TRANSFER_OUT+DEPRECIATION)%>%
group_by(LG_ID, NAME, AUDIT_YEAR)%>%
summarize(cost=mean(cost))%>%
ungroup()%>%
group_by(LG_ID, NAME)%>%
summarize(cost=mean(cost))
s5acost_ws=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(cm_audit, by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(cost=EXP_OPERATING+EXP_TRANSFER_OUT+DEPRECIATION)%>%
group_by(LG_ID, NAME, AUDIT_YEAR)%>%
summarize(cost=mean(cost))%>%
ungroup()%>%
group_by(LG_ID, NAME)%>%
summarize(cost=mean(cost))
hu5a=housingunits%>%
filter(year>=2010, year<=2014)%>%
select(LG_ID, year, totalhousingunits)%>%
group_by(LG_ID)%>%
summarize(housingunits=mean(as.numeric(totalhousingunits)))
mhi5a=codemog_api(data="b19013", db="acs1115", sumlev = "160", geography = "sumlev")%>%
mutate(place=as.numeric(place),
mhi=as.numeric(b19013001))%>%
left_join(oisplace, c("place"= "PLACE"))
View(mhi5a)
View(mhi5a)
mhi5a=codemog_api(data="b19013", db="acs1115", sumlev = "160", geography = "sumlev")%>%
mutate(place=as.numeric(place),
mhi=as.numeric(b19013001))%>%
left_join(oisplace, c("place"= "PLACE"))%>%
filter(is.na(LG_ID))
mhi5a=codemog_api(data="b19013", db="acs1115", sumlev = "160", geography = "sumlev")%>%
mutate(place=as.numeric(place),
mhi=as.numeric(b19013001))%>%
left_join(oisplace, c("place"= "PLACE"))%>%
filter(!is.na(LG_ID))
rm(mhi5a)
rm(hu5a)
hu5=housingunits%>%
filter(year>=2010, year<=2014)%>%
select(LG_ID, year, totalhousingunits)%>%
group_by(LG_ID)%>%
summarize(housingunits=mean(as.numeric(totalhousingunits)))
mhi5=codemog_api(data="b19013", db="acs1115", sumlev = "160", geography = "sumlev")%>%
mutate(place=as.numeric(place),
mhi=as.numeric(b19013001))%>%
left_join(oisplace, c("place"= "PLACE"))%>%
filter(!is.na(LG_ID))
s5a_data_ws=hu5%>%
inner_join(mhi5, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s5acost_ws, by="LG_ID")%>%
mutate(s5metric=debt/housingunits/mhi,
s5metric=ifelse(is.na(s5metric), 0,s5metric))
s5a_data_ws=hu5%>%
inner_join(mhi5, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s5acost_ws, by="LG_ID")%>%
mutate(s5metric=cost/housingunits/mhi,
s5metric=ifelse(is.na(s5metric), 0,s5metric))
s5a_data_sep=hu5%>%
inner_join(mhi5, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s5acost_sep, by="LG_ID")%>%
mutate(s5metric=cost/housingunits/mhi,
s5metric=ifelse(is.na(s5metric), 0,s5metric))
s5acost_sep=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(cm_audit, by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, EXP_OPERATING,EXP_TRANSFER_OUT,DEPRECIATION)%>%
mutate(cost=EXP_OPERATING+EXP_TRANSFER_OUT+DEPRECIATION)%>%
group_by(LG_ID, NAME, CM_FUND_TYPE_ID)%>%
summarize(cost=sum(cost))%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, cost)
s5a_data_sep=hu5%>%
inner_join(mhi5, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s5acost_sep, by="LG_ID")%>%
mutate(s5metric=cost/housingunits/mhi,
s5metric=ifelse(is.na(s5metric), 0,s5metric))
s5a_benchmark_ws=median(s5a_data_ws$s5metric)
s5a_benchmark_ws=median(s5a_data_ws$s5metric)
s5a_benchmark_sep=s5a_data_sep%>%
group_by(CM_FUND_TYPE_ID)%>%
summarize(s5a_benchmark_sep=median(s5metric))
s5a_benchmark_sep=s5a_data_sep%>%
mutate(name=paste0("s5a_benchmark_", CM_FUND_TYPE_ID))%>%
group_by(name)%>%
summarize(s5a_benchmark_sep=median(s5metric))%>%
spread(name, s5a_benchmark_sep)
View(s5a_benchmark_sep)
s5a_benchmark_sep=s5a_data_sep%>%
mutate(fundID=ifelse(CM_FUND_TYPE_ID==2, "w", "s"),
name=paste0("s5a_benchmark_", fundID))%>%
group_by(name)%>%
summarize(s5a_benchmark_sep=median(s5metric))%>%
spread(name, s5a_benchmark_sep)
s5a_benchmark_ws=data.frame(s5a_benchmark_ws=median(s5a_data_ws$s5metric))
s4_benchmark_ws=data.frame(s4_benchmark_ws(median(s4_data_ws$s4metric))
s4_benchmark_sep=s4_data_sep%>%
mutate(fundID=ifelse(CM_FUND_TYPE_ID==2, "w", "s"),
name=paste0("s4_benchmark_", fundID))%>%
group_by(name)%>%
summarize(s4_benchmark_sep=median(s4metric))%>%
spread(name, s4_benchmark_sep)
s4_benchmark_ws=data.frame(s4_benchmark_ws=median(s4_data_ws$s4metric))
s4_benchmark_sep=s4_data_sep%>%
mutate(fundID=ifelse(CM_FUND_TYPE_ID==2, "w", "s"),
name=paste0("s4_benchmark_", fundID))%>%
group_by(name)%>%
summarize(s4_benchmark_sep=median(s4metric))%>%
spread(name, s4_benchmark_sep)
s3_benchmark=data.frame(s3_benchmark=median(s3_data$s3metric))
