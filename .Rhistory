library(tidyverse)
library(codemogAPI)
source("C:/Users/rjame/Downloads/pw.R")
av=inner_join(lgbasic, lim_levy)
av=inner_join(lgbasic, lim_levy, by="LG_ID")
View(av)
names(lgbasic)
names(lim_levy)
av=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(lim_levy, -CREATED_BY:-UPDATED_BY), by="LG_ID")%>%
filter(SUBDIS_NUM==1, LGTYPE_ID%in%(2,3,4,5), BUDGET_YEAR>=2012 & BUDGET_YEAR<=2016)%>%
select(LG_ID, NAME, BUDGET_YEAR, ASSESSED_VALUE)
av=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(lim_levy, -CREATED_BY:-UPDATED_BY), by="LG_ID")%>%
filter(SUBDIS_NUM==1, LGTYPE_ID%in%c(2,3,4,5), BUDGET_YEAR>=2012 & BUDGET_YEAR<=2016)%>%
select(LG_ID, NAME, BUDGET_YEAR, ASSESSED_VALUE)
av=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(lim_levy, -CREATED_BY:-UPDATED_BY), by="LG_ID")%>%
filter(SUBDISY_NUM==1, LGTYPE_ID%in%c(2,3,4,5), BUDGET_YEAR>=2012 & BUDGET_YEAR<=2016)%>%
select(LG_ID, NAME, BUDGET_YEAR, ASSESSED_VALUE)
av=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(lim_levy, -CREATED_BY:-UPDATED_BY), by="LG_ID")%>%
filter(SUBDISt_NUM==1, LGTYPE_ID%in%c(2,3,4,5), BUDGET_YEAR>=2012 & BUDGET_YEAR<=2016)%>%
select(LG_ID, NAME, BUDGET_YEAR, ASSESSED_VALUE)
av=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(lim_levy, -CREATED_BY:-UPDATED_BY), by="LG_ID")%>%
filter(SUBDIST_NUM==1, LGTYPE_ID%in%c(2,3,4,5), BUDGET_YEAR>=2012 & BUDGET_YEAR<=2016)%>%
select(LG_ID, NAME, BUDGET_YEAR, ASSESSED_VALUE)
View(av)
av=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(lim_levy, -CREATED_BY:-UPDATED_BY), by="LG_ID")%>%
filter(SUBDIST_NUM==1, LGTYPE_ID%in%c(2,3,4,5), BUDGET_YEAR>=2012 & BUDGET_YEAR<=2016)%>%
select(LG_ID, NAME, BUDGET_YEAR, ASSESSED_VALUE)%>%
group_by(LG_ID,NAME)%>%
summarize(ASSESSED_VALUE=avg(ASSESSED_VALUE))
av=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(lim_levy, -CREATED_BY:-UPDATED_BY), by="LG_ID")%>%
filter(SUBDIST_NUM==1, LGTYPE_ID%in%c(2,3,4,5), BUDGET_YEAR>=2012 & BUDGET_YEAR<=2016)%>%
select(LG_ID, NAME, BUDGET_YEAR, ASSESSED_VALUE)%>%
group_by(LG_ID,NAME)%>%
summarize(ASSESSED_VALUE=average(ASSESSED_VALUE))
av=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(lim_levy, -CREATED_BY:-UPDATED_BY), by="LG_ID")%>%
filter(SUBDIST_NUM==1, LGTYPE_ID%in%c(2,3,4,5), BUDGET_YEAR>=2012 & BUDGET_YEAR<=2016)%>%
select(LG_ID, NAME, BUDGET_YEAR, ASSESSED_VALUE)%>%
group_by(LG_ID,NAME)%>%
summarize(ASSESSED_VALUE=mean(ASSESSED_VALUE))
View(av)
View(av)
av=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(lim_levy, -CREATED_BY:-UPDATED_BY), by="LG_ID")%>%
filter(SUBDIST_NUM==1 } SUBDIST_NUM==2, LGTYPE_ID%in%c(2,3,4,5, 61, 70), BUDGET_YEAR>=2012 & BUDGET_YEAR<=2016)%>%
select(LG_ID, NAME, BUDGET_YEAR, ASSESSED_VALUE)%>%
group_by(LG_ID,NAME)%>%
summarize(ASSESSED_VALUE=mean(ASSESSED_VALUE))
av=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(lim_levy, -CREATED_BY:-UPDATED_BY), by="LG_ID")%>%
filter(SUBDIST_NUM==1 , SUBDIST_NUM==2, LGTYPE_ID%in%c(2,3,4,5, 61, 70), BUDGET_YEAR>=2012 & BUDGET_YEAR<=2016)%>%
select(LG_ID, NAME, BUDGET_YEAR, ASSESSED_VALUE)%>%
group_by(LG_ID,NAME)%>%
summarize(ASSESSED_VALUE=mean(ASSESSED_VALUE))
av=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(lim_levy, -CREATED_BY:-UPDATED_BY), by="LG_ID")%>%
filter(SUBDIST_NUM==1 | SUBDIST_NUM==2, LGTYPE_ID%in%c(2,3,4,5, 61, 70), BUDGET_YEAR>=2012 & BUDGET_YEAR<=2016)%>%
select(LG_ID, NAME, BUDGET_YEAR, ASSESSED_VALUE)%>%
group_by(LG_ID,NAME)%>%
summarize(ASSESSED_VALUE=mean(ASSESSED_VALUE))
View(av)
s3_data=inner_join(av, housingunits, by="LG_ID")
names(housingunits)
hu3=housingunits%>%
filter(year>2010)%>%
select(LG_ID, year, totalhousingunits)%>%
group_by(LG_ID)%>%
summarize(housingunits=mean(totalhousingunits))
s3_data=inner_join(av, hu3, by="LG_ID")
s3_data=inner_join(av, hu3, by="LG_ID")%>%
mutate(s3metric=ASSESSED_VALUE/housingunits)
View(s3_data)
str(hu3)
s3_data=inner_join(av, hu3, by="LG_ID")%>%
mutate(s3metric=ASSESSED_VALUE/housingunits)
hu3=housingunits%>%
filter(year>2010)%>%
select(LG_ID, year, totalhousingunits)%>%
group_by(LG_ID)%>%
summarize(housingunits=mean(totalhousingunits, na.rm=T))
hu3=housingunits%>%
filter(year>2010)%>%
select(LG_ID, year, totalhousingunits
)
View(hu3)
hu3=housingunits%>%
filter(year>2010)%>%
select(LG_ID, year, totalhousingunits)%>%
group_by(LG_ID)%>%
summarize(housingunits=mean(as.numeric(totalhousingunits)))
s3_data=inner_join(av, hu3, by="LG_ID")%>%
mutate(s3metric=ASSESSED_VALUE/housingunits)
View(s3_data)
x=anti_join(av, hu3, by="LG_ID")
x
names(housingunits)
View(oisplace)
carbonate=data.frame(municipality="Carbonate", year=c(2010:2015), placefips=NA,totalhousingunits=0,
FIPS_CLASS_CODE=NA, PLACECE=NA, LG_ID=66636, DOR_CODE=NA, CREATED_ON=NA,
CREATED_BY=NA, UPDATED_ON=NA, UPDATED_BY=NA, FEATURE_ID=NA)
View(carbonate)
housingunits=bind_rows(housingunits, carbonate)
carbonate=data.frame(municipality="Carbonate", year=c(2010:2015), placefips=NA,totalhousingunits="0",
FIPS_CLASS_CODE=NA, PLACECE=NA, LG_ID=66636, DOR_CODE=NA, CREATED_ON=NA,
CREATED_BY=NA, UPDATED_ON=NA, UPDATED_BY=NA, FEATURE_ID=NA)
housingunits=bind_rows(housingunits, carbonate)
av=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(lim_levy, -CREATED_BY:-UPDATED_BY), by="LG_ID")%>%
filter(SUBDIST_NUM==1 | SUBDIST_NUM==2, LGTYPE_ID%in%c(2,3,4,5, 61, 70), BUDGET_YEAR>=2012 & BUDGET_YEAR<=2016)%>%
select(LG_ID, NAME, BUDGET_YEAR, ASSESSED_VALUE)%>%
group_by(LG_ID,NAME)%>%
summarize(ASSESSED_VALUE=mean(ASSESSED_VALUE))
hu3=housingunits%>%
filter(year>2010)%>%
select(LG_ID, year, totalhousingunits)%>%
group_by(LG_ID)%>%
summarize(housingunits=mean(as.numeric(totalhousingunits)))
s3_data=inner_join(av, hu3, by="LG_ID")%>%
mutate(s3metric=ASSESSED_VALUE/housingunits)
View(hu3)
View(s3_data)
s3_benchmark=median(s3_data$s3metric)
names(cm_audit)
names(cm_fund)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(cm_fund, by=c("LG_ID"="CM_AUDIT_ID"))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(cm_fund, by=c("LG_ID"="CM_AUDIT_ID"))%>%
filter(LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030)
View(cm_fund)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -CREATED_BY:-UPDATED_BY), by="LG_ID")%>%
inner_join(cm_fund, by="CM_AUDIT_ID")%>%
filter(LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")
View(s4debt)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(dept=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))
View(s4debt)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
unique(filter(s4debt, AUDIT_YEAR=2014)$LG_ID)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
unique(filter(s4debt, AUDIT_YEAR==2014)$LG_ID)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
names(s4debt)
View(select(s4debt, LG_ID, NAME, debt))
View(select(s4debt, LG_ID, NAME, debt, AUDIT_YEAR))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3),LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
View(s4debt)
View(select(s4debt, LG_ID, NAME, debt, AUDIT_YEAR))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
names(s4debt)
View(s4debt)
View(select(LG_ID, NAME, AUDIT_YEAR, CM_FUND_TYPE_ID, GO_DEBT,REVENUE_DEBT, OTHER_DEBT, debt))
View(select(s4debt,LG_ID, NAME, AUDIT_YEAR, CM_FUND_TYPE_ID, GO_DEBT,REVENUE_DEBT, OTHER_DEBT, debt))
x=select(s4debt,LG_ID, NAME, AUDIT_YEAR, CM_FUND_TYPE_ID, GO_DEBT,REVENUE_DEBT, OTHER_DEBT, debt))
x=select(s4debt,LG_ID, NAME, AUDIT_YEAR, CM_FUND_TYPE_ID, GO_DEBT,REVENUE_DEBT, OTHER_DEBT, debt)
View(x)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))
y=anti_join(s3_data, s4debt. by="LG_ID")
y=anti_join(s3_data, s4debt, by="LG_ID")
y
z=unique(x$LG_ID)
z
hu4=housingunits%>%
filter(year>=2010, year<=2014)%>%
select(LG_ID, year, totalhousingunits)%>%
group_by(LG_ID)%>%
summarize(housingunits=mean(as.numeric(totalhousingunits)))
library(codemog)
devtools::install_github("robkemp/codemog")
library(codemog)
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "150", geography = "sumlev")
View(mhv4)
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "160", geography = "sumlev")
View(mhv4)
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "150", geography = "sumlev")%>%
inner_join(oisplace, c("place"= "PLACE"))
str(mhv4)
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "150", geography = "sumlev")%>%
mutate(place=as.numeric(place))%>%
inner_join(oisplace, c("place"= "PLACE"))
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "150", geography = "sumlev")%>%
mutate(place=as.numeric(place))%>%
left_join(oisplace, c("place"= "PLACE"))
View(mhv4)
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")
s4_data=hu4%>%
left_join(mhv4, by="LG_ID")
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")
View(s4_data)
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "160", geography = "sumlev")%>%
mutate(place=as.numeric(place))%>%
left_join(oisplace, c("place"= "PLACE"))
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))
View(s4_data)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))%>%
select(LG_ID, NAME, debt)
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s4debt, by="LG_ID")
View(mhv4)
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "160", geography = "sumlev")%>%
mutate(place=as.numeric(place),
mhv=as.numeric(b25077001))%>%
left_join(oisplace, c("place"= "PLACE"))
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
mutate(s4metric=debt/housingunits/mhv)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))%>%
select(LG_ID, NAME, debt)
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s4debt, by="LG_ID")%>%
mutate(s4metric=debt/housingunits/mhv)
s4_benchmark=median(s4_data$s4metric)
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s4debt, by="LG_ID")
mhv4=codemog_api(data="b25077", db="acs1115", sumlev = "160", geography = "sumlev")%>%
mutate(place=as.numeric(place),
mhv=as.numeric(b25077001))%>%
left_join(oisplace, c("place"= "PLACE"))
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s4debt, by="LG_ID")%>%
mutate(s4metric=debt/housingunits/mhv)
s4_benchmark=median(s4_data$s4metric)
s4_data=hu4%>%
inner_join(mhv4, by="LG_ID")%>%
filter(!is.na(LG_ID))%>%
inner_join(s4debt, by="LG_ID")%>%
mutate(s4metric=debt/housingunits/mhv,
s4metric=ifelse(is.na(s4metric), 0,s4metric))
s4_benchmark=median(s4_data$s4metric)
s5debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(cost=EXP_OPERATING+EXP_TRANSFER+DEPRECIATION)%>%
group_by(LG_ID, NAME)%>%
summarize(cost=mean(cost))%>%
select(LG_ID, NAME, cost)
## WHY AM I GETTING ONLY 235
##LIST OF PLACE NOT IN THERE
y5=anti_join(s3_data, s5debt, by="LG_ID")
s5debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
mutate(cost=EXP_OPERATING+EXP_TRANSFER_OUT+DEPRECIATION)%>%
group_by(LG_ID, NAME)%>%
summarize(cost=mean(cost))%>%
select(LG_ID, NAME, cost)
## WHY AM I GETTING ONLY 235
##LIST OF PLACE NOT IN THERE
y5=anti_join(s3_data, s5debt, by="LG_ID")
s5debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)
names(s5debt)
names(cm_audit)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)
View(s4debt)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)
View(s4debt)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME< AUDIT_YEAR)%>%
summarize(debt=mean(debt))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, AUDIT_YEAR)%>%
summarize(debt=mean(debt))
View(s4debt)
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)
View(arrange(s4debt, LG_ID, AUDIT_YEAR))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, AUDIT_YEAR)%>%
summarize(debt=mean(debt))
s4debt=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, AUDIT_YEAR)%>%
summarize(debt=sum(debt))
s4debt_2and3=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, AUDIT_YEAR)%>%
summarize(debt=sum(debt))%>%
ungroup()%>%
group_by(LG_ID, NAME)%>%
ummarize(debt=mean(debt))
s4debt_2and3=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, AUDIT_YEAR)%>%
summarize(debt=sum(debt))%>%
ungroup()%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))
s4debt_1=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(1,2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, AUDIT_YEAR)%>%
summarize(debt=sum(debt))%>%
ungroup()%>%
group_by(LG_ID, NAME)%>%
summarize(debt=mean(debt))
s4debt_2and3=lgbasic%>%
select(-CREATED_BY:-OSA)%>%
inner_join(select(cm_audit, -UPDATED_ON:-UPDATED_BY), by="LG_ID")%>%
inner_join(select(cm_fund, -CREATED_ON:-UPDATED_BY), by="CM_AUDIT_ID")%>%
filter(CM_FUND_TYPE_ID%in%c(2,3), LGTYPE_ID%in%c(2,3,4,5), LG_ID!=16002, LG_ID!=64030, AUDIT_YEAR>=2010, AUDIT_YEAR<=2014)%>%
select(LG_ID, NAME, CM_FUND_TYPE_ID, AUDIT_YEAR, GO_DEBT,REVENUE_DEBT,OTHER_DEBT)%>%
mutate(debt=GO_DEBT+REVENUE_DEBT+OTHER_DEBT)%>%
group_by(LG_ID, NAME, CM_FUND_TYPE_ID)%>%
summarize(debt=sum(debt))
View(s4debt_2and3)
